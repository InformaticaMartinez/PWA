<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>TP2 – Integrado</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>

<body>
<div id="app">

    <h1>Hola mi nombre es {{ nombre }}, tengo {{ edad }} años y vivo en {{ ciudad }}</h1>

    <h2>Contador: {{ contador }}</h2>
    <button @click="contador++">+</button>
    <button @click="contador--">−</button>

    <br><br>
    <input v-model="nuevaTarea" placeholder="Escribe una tarea">
    <button @click="agregarTarea">Añadir Tarea</button>

    <ul>
        <li v-for="t in tareas" :key="t.id">
            <input type="checkbox" v-model="t.completada">
            <span :class="{ completada: t.completada }">{{ t.texto }}</span>
        </li>
    </ul>

    <p>Total de tareas: {{ totalTareas }}</p>
    <p>Tareas pendientes: {{ tareasPendientes }}</p>

    <div class="eventos-lista">
        <h2>Paso 1 – Lista de Eventos del Ciclo de Vida</h2>
        <ul>
            <li v-for="ev in listaeventos" :key="ev.id">
                <strong>{{ ev.id }}</strong> — {{ ev.nombre }} — {{ ev.timestamp }}
            </li>
        </ul>
    </div>

    <h2>Paso 2 – Implementación de Axios</h2>

    <input v-model="postId" placeholder="Número de Post">
    <button @click="cargarPost">Obtener Post</button>
    <button @click="cargarComments">Obtener Comentarios</button>

    <h3>Post</h3>
    <pre>{{ post }}</pre>

    <h3>Comentarios</h3>
    <ul>
        <li v-for="c in comments" :key="c.id">
            {{ c.email }} — {{ c.body }}
        </li>
    </ul>

</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            nombre: "Julio",
            edad: 48,
            ciudad: "General Roca",
            contador: 0,
            nuevaTarea: "",
            nextId: 4,
            tareas: [
                { id: 1, texto: "Aprender Vue", completada: false },
                { id: 2, texto: "Aprender PWA", completada: false },
                { id: 3, texto: "Aprender COMPUTED", completada: false }
            ],

            listaeventos: [],
            nextEventId: 1,
            primeraActualizacion: true,

            postId: "",
            post: {},
            comments: []
        };
    },

    computed: {
        totalTareas() {
            return this.tareas.length;
        },
        tareasPendientes() {
            return this.tareas.filter(t => !t.completada).length;
        }
    },

    methods: {
        agregarTarea() {
            if (this.nuevaTarea.trim() !== "") {
                this.tareas.push({
                    id: this.nextId++,
                    texto: this.nuevaTarea,
                    completada: false
                });
            }
            this.nuevaTarea = "";
        },

        registrar(nombre) {
            this.listaeventos.push({
                id: this.nextEventId++,
                nombre,
                timestamp: Date.now()
            });
        },

        async obtenerPost(id) {
            const api = axios.create({
                baseURL: "https://jsonplaceholder.typicode.com"
            });
            const r = await api.get(`/posts/${id}`);
            return r.data;
        },

        async obtenerComments(id) {
            const api = axios.create({
                baseURL: "https://jsonplaceholder.typicode.com"
            });
            const r = await api.get(`/posts/${id}/comments`);
            return r.data;
        },

        async cargarPost() {
            this.post = await this.obtenerPost(this.postId);
        },

        async cargarComments() {
            this.comments = await this.obtenerComments(this.postId);
        }
    },

    created() {
        this.registrar("beforeCreate");
        this.registrar("created");
    },

    beforeMount() {
        this.registrar("beforeMount");
    },

    mounted() {
        this.registrar("mounted");
    },

    beforeUpdate() {
        if (this.primeraActualizacion) {
            this.registrar("beforeUpdate");
        }
    },

    updated() {
        if (this.primeraActualizacion) {
            this.registrar("updated");
            this.primeraActualizacion = false;
        }
    },

    beforeUnmount() {
        this.registrar("beforeUnmount");
    },

    unmounted() {
        this.registrar("unmounted");
    }

}).mount("#app");
</script>

</body>
</html>
